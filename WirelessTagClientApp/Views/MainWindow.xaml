<Window x:Class="WirelessTagClientApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WirelessTagClientApp.Views"
        xmlns:localViewModels="clr-namespace:WirelessTagClientApp.ViewModels"
        xmlns:converters="clr-namespace:ValueConverters;assembly=ValueConverters"
        xmlns:busyIndicator="https://github.com/Peoky/BusyIndicator"
        mc:Ignorable="d"
        x:Name="mainWindow"
        Icon="/Images/ThermometerNavyWhiteSquare.ico"
        WindowStyle="ThreeDBorderWindow"
        ResizeMode="CanResizeWithGrip"
        Background="GhostWhite"
        Title="WirelessTag App"
        Height="450"
        Width="800">

    <Window.InputBindings>
        <KeyBinding Command="{Binding Path=CloseCommand}" Key="F4" Modifiers="Ctrl" CommandParameter="{Binding}"/>
        <KeyBinding Command="{Binding Path=CloseCommand}" Key="Esc" CommandParameter="{Binding}"/>
        <KeyBinding Command="{Binding Path=AboutCommand}" Key="F1" CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Window}}}"/>
    </Window.InputBindings>

    <Window.Resources>

        <DataTemplate DataType="{x:Type localViewModels:AllTagsViewModel}">
            <local:AllTagsView />
        </DataTemplate>

        <DataTemplate DataType="{x:Type localViewModels:MinMaxViewModel}">
            <local:MinMaxView />
        </DataTemplate>

        <converters:BoolToVisibilityConverter x:Key="visibilityConverter" />
    </Window.Resources>

    <busyIndicator:BusyMask      
        IndicatorType="ThreeDots"       
        BusyContent="Please wait..."
        IsBusy="{Binding Path=IsBusy}">

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="auto" />
                <RowDefinition Height="auto" />
            </Grid.RowDefinitions>

            <ContentControl
                Grid.Row="0"
                Content="{Binding Path=ActiveViewModel}" />

            <StackPanel
                Grid.Row="1" Orientation="Horizontal" Margin="6">

                <TextBlock
                    Padding="6,0,6,0"
                    Text="Last Updated:"/>
                <TextBlock
                    TextTrimming="CharacterEllipsis"
                    Text="{Binding Path=LastUpdated, StringFormat={}{0:ddd dd-MMM-yyyy HH:mm:ss} }" />
            </StackPanel>

            <TextBlock
                Grid.Row="2"
                FontSize="24"
                Padding="6"
                FontStyle="Italic"
                Foreground="Crimson"
                Background="LightPink"
                TextTrimming="CharacterEllipsis"
                Text="{Binding Path=ErrorMessage}"
                Visibility="{Binding Path=IsError, Converter={StaticResource visibilityConverter}}" />
        </Grid>

    </busyIndicator:BusyMask>
</Window>
